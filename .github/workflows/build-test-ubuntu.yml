name: Linux Build and Test

on:
  #push:
  #  branches: [ "master" ]
  #pull_request:
  #  branches: [ "master" ]
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'
        required: false
        default: 'info'

env:
  CARGO_TERM_COLOR: always

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
      with:
        ref: ${{ github.ref }}
    #- uses: MachineDynamo/rust-action@master
    #  with:
    #    #args: cd integration-test && cargo fmt -- --check && cargo clippy -- -Dwarnings && cargo test
    #    args: "cd integration-test; rustup target list; rustc --version; cargo build --target x86_64-unknown-linux-musl --release; cargo test --target x86_64-unknown-linux-musl --release;"
    - name: Build project # This would actually build your project, using zip for an example artifact
      run: |
        sudo apt-get install -y musl
        rustup add target x86_64-unknown-linux-musl
        echo "Building for Linux"
        rustc --version
        cargo build --verbose -r --target=x86_64-unknown-linux-musl
        cargo test --verbose -r --target=x86_64-unknown-linux-musl
    #- name: Build
    #  uses: stevenleadbeater/rust-musl-builder@master
    #  run: |
    #    rustc --version
    #    cargo build --verbose -r --target=x86_64-unknown-linux-musl
    #- name: Run tests
    #  run: cargo test --verbose -r --target=x86_64-unknown-linux-musl
